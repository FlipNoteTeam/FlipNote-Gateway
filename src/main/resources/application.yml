server:
  port: 8080

spring:
  application:
    name: api-gateway

  cloud:
    gateway:
      default-filters:
        - RemoveRequestHeader=X-User-Id
        - RemoveRequestHeader=X-User-Email
        - RemoveRequestHeader=X-User-Role
      routes:
        - id: user-private
          uri: http://user-service:8081
          predicates:
            - name: Path
              args:
                patterns:
                  - /v1/users/me
                  - /v1/users/{userId}
                  - /v1/users
          filters:
            - AuthenticationFilter

        - id: auth-public
          uri: http://user-service:8081
          predicates:
            - name: Path
              args:
                patterns:
                  - /v1/auth/login
                  - /v1/auth/register
                  - /v1/auth/token/refresh
                  - /v1/auth/email-verification/request
                  - /v1/auth/email-verification
                  - /v1/auth/password-reset/request
                  - /v1/auth/password-reset
                  - /v1/oauth2/callback/*

        - id: auth-private
          uri: http://user-service:8081
          predicates:
            - name: Path
              args:
                patterns:
                  - /v1/auth/logout
                  - /v1/auth/password
                  - /v1/auth/social-links
                  - /v1/auth/social-links/*
                  - /v1/oauth2/authorization/*
                  - /v1/oauth2/links/*

          filters:
            - AuthenticationFilter

        - id: user-swagger
          uri: http://user-service:8081
          predicates:
            - name: Path
              args:
                patterns:
                  - /users/swagger-ui.html
                  - /users/swagger-ui/**
                  - /users/v3/api-docs
                  - /users/v3/api-docs/**

        - id: reaction-private
          uri: http://reaction-service:8083
          predicates:
            - name: Path
              args:
                patterns:
                  - /v1/likes/{targetType}/{targetId}
                  - /v1/likes/{targetType}
                  - /v1/bookmarks/{targetType}/{targetId}
                  - /v1/bookmarks/{targetType}
          filters:
            - AuthenticationFilter

        - id: image-public
          uri: http://image-service:8082
          predicates:
            - Path=/v1/images/upload

        - id: image-private
          uri: http://image-service:8082
          predicates:
            - Path=/v1/images/**
          filters:
            - AuthenticationFilter

app:
  user-service:
    url: http://user-service:8081

management:
  endpoints:
    web:
      exposure:
        include: health

logging:
  level:
    flipnote.apigateway: INFO
